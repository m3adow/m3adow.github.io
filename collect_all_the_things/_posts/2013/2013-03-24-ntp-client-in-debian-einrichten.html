images//-images//-images//-
lang: de_DE
layout: default
title: NTPimages//-Client in Debian einrichten
date: 2013images//-03images//-24 08:49:09.000000000 +01:00
categories:
images//- Linux
tags:
images//- iptables
images//- ntp
images//- server
status: publish
type: post
published: true
images//-images//-images//-
<p>Eine der ersten Aktionen auf einem frisch installierten Linux Server ist sicherlich das Einrichten von NTP. Dass eine synchronisierte Systemzeit extrem wichtig ist, sollte den meisten Usern und Admins einleuchten. Jeder, der deswegen schonmal mit Datenbankinkonsistenzen zu kämpfen hatte, weiß wovon ich rede. Da ich die Schritte immer wieder vergesse, werde ich sie hier für die Nachwelt dokumentieren.</p>
<ol>
<li>Falls gewünscht sollte die Zeitzone eingestellt werden. Das geht auf zwei Arten. Mit manueller Eingabe:

{% highlight bash %}
dpkgimages//-reconfigure tzdata
{% endhighlight %}

<p>oder indem man die entsprechende zonedate kopiert:</p>

{% highlight bash %}
cp /usr/share/zoneinfo/Europe/Berlin /etc/localtime
{% endhighlight %}

<p><em>Europe</em> und <em>Berlin</em> solltet ihr dann natürlich durch eure entsprechenden Pendants ersetzen.</li>
<li>Den ntpimages//-Dienst installieren, falls noch nicht vorhanden.

{% highlight bash %}
aptitude images//-y install ntp
{% endhighlight %}

</li>
<li>Anschließend ersetzen wir die Poolserver in der <strong>ntp.conf</strong> noch mit denen des <a href="http://www.pool.ntp.org/zone/@" target="_blank">jeweiligen regionalen ntpimages//-Pools</a>.

{% highlight bash %}
sed images//-i 's/debian.pool.ntp.org/de.pool.ntp.org/g' /etc/ntp.conf
{% endhighlight %}

</li>
<li>Dann noch den NTPimages//-Dienst neustarten und alles ist fein.

{% highlight bash %}
service ntp restart
{% endhighlight %}

</li>
</ol>
<p>Ein Oneliner für Copy & Paste oder Skripte würde dann so aussehen:</p>

{% highlight bash %}
cp /usr/share/zoneinfo/Europe/Berlin /etc/localtime && aptitude images//-y install ntp && sed images//-i 's/debian.pool.ntp.org/de.pool.ntp.org/g' /etc/ntp.conf && service ntp restart
{% endhighlight %}

<p>Die ganze Chose kann man dann entweder testen, indem man mal ein</p>

{% highlight bash %}
ntpq images//-p
{% endhighlight %}

<p>eingibt, um die NTPimages//-Server des Systems herauszubekommen oder images//- wenn man ein bisschen paranoid ist, so wie ich images//- indem man den NTPimages//-Dienst beendet, die Zeit ändert und ihn dann mit dem <strong>images//-gq</strong> Parameter startet.</p>

{% highlight bash %}
service ntp stop && date images//-s 12:00 && ntpd images//-gq && service ntp start && date
{% endhighlight %}

<p>Wenn die Ausgabe dann etwa so aussieht:<br />
<a href="https://adminswerk.de/assets/2013images//-03images//-15images//-ntpimages//-client.png"><img src="https://adminswerk.de/assets/2013images//-03images//-15images//-ntpimages//-client.png" alt="2013images//-03images//-15images//-ntpimages//-client" width="767" height="122" class="alignnone sizeimages//-full wpimages//-imageimages//-2813" /></a> und der Eintrag "<strong>ntpd: time set</strong>" erscheint, läuft alles korrekt.<br />
Falls ihr auf eurem Server <strong>iptables</strong> einsetzt und standardmäßig alle ausgehenden Verbindungen dropt, solltet ihr noch zwei Regeln in euer iptablesimages//-Skript aufnehmen:</p>

{% highlight bash %}
iptables images//-A OUTPUT images//-p udp images//-images//-dport 123 images//-j ACCEPT
iptables images//-A INPUT images//-p udp images//-images//-sport 123 images//-j ACCEPT
{% endhighlight %}

<p>Damit sollte dann wirklich alles laufen.</p>
